<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>NOUN Benin Study Centre — Rate Staff</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root {
      --nav-width: 220px;
      --brand: #008000; /* Green */
      --accent: #006400; /* Darker green */
      --muted: #6b7280;
    }
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
    }
    body {
      background: #f4f4f4;
      min-height: 100vh;
    }
    .sidebar {
      width: var(--nav-width);
      background: var(--brand);
      color: #fff;
      height: 100vh;
      position: fixed;
      top: 0;
      left: 0;
      padding-top: 20px;
    }
    .sidebar h2 {
      text-align: center;
      color: #fff;
      margin-bottom: 18px;
      font-size: 18px;
    }
    .sidebar a {
      display: block;
      color: #fff;
      padding: 12px 18px;
      text-decoration: none;
      font-weight: 600;
    }
    .sidebar a:hover {
      background: var(--accent);
    }
    .header-bar {
      margin-left: var(--nav-width);
      background: #fff;
      padding: 12px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid #e6e9ee;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .header-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .header-left img {
      width: 45px;
      height: 45px;
      object-fit: contain;
    }
    .header-left span {
      font-size: 20px;
      font-weight: 800;
      color: var(--brand);
    }
    .top-menu {
      margin-left: var(--nav-width);
      background: var(--brand);
      padding: 8px 20px;
      display: flex;
      gap: 20px;
      justify-content: center;
    }
    .top-menu a {
      color: #fff;
      text-decoration: none;
      font-weight: 600;
    }
    .welcome-banner {
      margin-left: var(--nav-width);
      margin-top: 10px;
      height: 96px;
      background-image: url('https://img.freepik.com/free-photo/college-students-corridor_23-2147666538.jpg');
      background-size: cover;
      background-position: center;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 6px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.06);
    }
    .welcome-text {
      color: #fff;
      font-size: 26px;
      font-weight: 900;
      background: rgba(0, 100, 0, 0.5);
      padding: 10px 16px;
      border-radius: 6px;
    }
    .main {
      margin-left: var(--nav-width);
      padding: 20px;
    }
    .card {
      background: #fff;
      padding: 16px;
      border-radius: 10px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.04);
      margin-bottom: 16px;
    }
    .rate-section {
      display: grid;
      grid-template-columns: 320px 1fr;
      gap: 18px;
      margin-top: 12px;
    }
    .profile-box img {
      width: 100%;
      height: 220px;
      object-fit: cover;
      border-radius: 8px;
    }
    .profile-details h2 {
      color: var(--brand);
      margin-bottom: 6px;
      font-size: 20px;
    }
    .btn {
      padding: 10px 14px;
      background: var(--accent);
      color: #fff;
      border-radius: 8px;
      border: 0;
      cursor: pointer;
      font-weight: 700;
    }
    .btn.secondary {
      background: var(--brand);
    }
    .compact .row {
      display: flex;
      gap: 10px;
      align-items: center;
      margin: 8px 0;
    }
    .compact label {
      min-width: 160px;
      font-weight: 600;
      color: #333;
    }
    textarea {
      width: 100%;
      min-height: 120px;
      padding: 10px;
      border: 1px solid #e6e9ee;
      border-radius: 6px;
    }
    .history-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 8px;
    }
    .history-table th, .history-table td {
      padding: 10px;
      border-bottom: 1px solid #eef2f6;
      text-align: left;
      font-size: 14px;
    }
    .history-table th {
      background: #e8f5e9;
      color: var(--accent);
      font-weight: 700;
    }
    .error {
      color: #b91c1c;
      margin-top: 12px;
      font-weight: 700;
    }
    footer {
      margin-left: var(--nav-width);
      padding: 12px;
      text-align: center;
      color: #666;
    }
    @media (max-width: 920px) {
      .rate-section { grid-template-columns: 1fr; }
      .profile-box img { height: 160px; }
    }
  </style>
</head>
<body>
  <nav class="sidebar">
    <h2>NOUN Admin Panel</h2>
    <a href="control-center.html">Dashboard</a>
    <a href="all-employees.html">All Staff</a>
    <a href="configure-criteria.html">Configure Criteria</a>
    <a href="manage-users.html">Manage Users</a>
    <a href="rate-staff.html">Rate Staff</a>
    <a href="reports.html">Reports</a>
    <a href="settings.html">Settings</a>
  </nav>

  <header class="header-bar">
    <div class="header-left">
      <img src="https://upload.wikimedia.org/wikipedia/en/1/12/NOUN_logo.png" alt="NOUN Logo">
      <span>NOUN — Benin Study Centre Staff Rating Portal</span>
    </div>
    <div class="header-right">
      <a href="index.html" id="logoutBtn" style="color:var(--brand);font-weight:700;text-decoration:none">Log Out</a>
    </div>
  </header>

  <div class="top-menu">
    <a href="about.html">About</a>
    <a href="events.html">Events</a>
    <a href="all-employees.html">View All Staff</a>
    <a href="reports.html">Reports</a>
  </div>

  <section class="welcome-banner">
    <div class="welcome-text">Rate Staff</div>
  </section>

  <main class="main">
    <section class="card">
      <h3 style="margin:0 0 10px;color:var(--accent)">Submit Rating</h3>
      <div class="rate-section">
        <div class="profile-box" id="staffProfileBox">
          <img id="staffPhoto" src="https://i.pravatar.cc/400?img=12" alt="Staff Photo">
          <div class="profile-details">
            <h2 id="staffName">Loading...</h2>
            <div><strong>Department:</strong> <span id="staffDept">—</span></div>
            <div><strong>Email:</strong> <span id="staffEmail">—</span></div>
            <div><strong>Phone:</strong> <span id="staffPhone">—</span></div>
            <div class="bio" id="staffBio">—</div>
            <div style="margin-top:8px">
              <button class="btn secondary" id="viewHistoryBtn">View History</button>
              <button class="btn" id="openReportBtn" style="margin-left:8px">Open Report</button>
            </div>
          </div>
        </div>
        <div class="rating-form" id="ratingFormArea">
          <h4>Submit Rating for <span id="rateForName">—</span></h4>
          <div class="compact">
            <div class="row">
              <label>Clarity of Instruction</label>
              <div>
                <label><input type="radio" name="c1" value="1">1</label>
                <label><input type="radio" name="c1" value="2">2</label>
                <label><input type="radio" name="c1" value="3">3</label>
                <label><input type="radio" name="c1" value="4">4</label>
                <label><input type="radio" name="c1" value="5">5</label>
              </div>
            </div>
            <div class="row">
              <label>Knowledge of Subject</label>
              <div>
                <label><input type="radio" name="c2" value="1">1</label>
                <label><input type="radio" name="c2" value="2">2</label>
                <label><input type="radio" name="c2" value="3">3</label>
                <label><input type="radio" name="c2" value="4">4</label>
                <label><input type="radio" name="c2" value="5">5</label>
              </div>
            </div>
          </div>
          <textarea id="comment" placeholder="Enter feedback..."></textarea>
          <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
            <label><input type="checkbox" id="anon"> Submit anonymously</label>
            <div style="flex:1"></div>
            <button class="btn" id="submitRatingBtn">Submit</button>
          </div>
          <div id="errorMsg" class="error" style="display:none">Cannot rate same staff twice in this session.</div>
          <div id="ratingMsg" style="font-size:13px;color:var(--muted);margin-top:8px"></div>
        </div>
      </div>
    </section>

    <section class="card" id="historySection" style="display:none">
      <h3>Rating History — <span id="historyFor">—</span></h3>
      <table class="history-table">
        <thead><tr><th>Date</th><th>Criteria</th><th>Score</th><th>Comments</th></tr></thead>
        <tbody id="ratingsBody">
          <tr><td colspan="4" style="text-align:center;color:var(--muted)">No ratings yet</td></tr>
        </tbody>
      </table>
    </section>
  </main>

  <footer>
    © 2025 National Open University of Nigeria (NOUN), Benin Study Centre — Designed by Barnabas Blessing
  </footer>

  <script>
    const $ = id => document.getElementById(id);

    function generateDemoEmployees() {
      const STAFF = [
        { name: "Dr. Grace Ogbemudia", dept: "Computer Science", title: "Lecturer" },
        { name: "Dr. Aisha Lawal", dept: "Education", title: "Lecturer" },
        { name: "Mr. Tunde Bello", dept: "Admin", title: "Staff" },
        { name: "Mrs. Ngozi Nwosu", dept: "Accounting", title: "Lecturer" },
        { name: "Dr. Ibrahim Musa", dept: "Economics", title: "Lecturer" },
      ];
      const PHOTOS = [
        'https://randomuser.me/api/portraits/men/45.jpg',
        'https://randomuser.me/api/portraits/women/46.jpg',
        'https://randomuser.me/api/portraits/men/47.jpg',
        'https://randomuser.me/api/portraits/women/48.jpg'
      ];
      const DEPARTMENTS = ['ICT', 'Admin', 'Finance', 'Education', 'Registry'];
      return Array.from({ length: 25 }).map((_, idx) => {
        const base = STAFF[idx % STAFF.length];
        const id = idx + 1;
        return {
          id,
          fullName: base.name,
          department: DEPARTMENTS[idx % DEPARTMENTS.length],
          email: `${base.name.toLowerCase().replace(/[^a-z]/g,'')}.${id}@noun.edu.ng`,
          phone: '+2348072417770',
          photo: PHOTOS[idx % PHOTOS.length],
          bio: `${base.name} is a ${base.title} at the National Open University of Nigeria, Benin Study Centre.`,
          history: []
        };
      });
    }

    let EMPLOYEES = JSON.parse(localStorage.getItem('EMPLOYEES_DATA') || '[]');
    if (!EMPLOYEES.length) {
      EMPLOYEES = generateDemoEmployees();
      localStorage.setItem('EMPLOYEES_DATA', JSON.stringify(EMPLOYEES));
    }

    const params = new URLSearchParams(window.location.search);
    const staffId = parseInt(params.get('id') || '1', 10);
    const staff = EMPLOYEES.find(e => e.id === staffId) || EMPLOYEES[0];

    $('staffPhoto').src = staff.photo;
    $('staffName').textContent = staff.fullName;
    $('staffDept').textContent = staff.department;
    $('staffEmail').textContent = staff.email;
    $('staffPhone').textContent = staff.phone;
    $('staffBio').textContent = staff.bio;
    $('rateForName').textContent = staff.fullName;

    const submittedThisSession = new Set();
    const submitBtn = $('submitRatingBtn');
    const msgEl = $('ratingMsg');
    const errorEl = $('errorMsg');

    function getSelectedRadioValue(name) {
      const el = document.querySelector(`input[name="${name}"]:checked`);
      return el ? el.value : null;
    }

    submitBtn.addEventListener('click', () => {
      const c1 = getSelectedRadioValue('c1');
      const c2 = getSelectedRadioValue('c2');
      const comment = $('comment').value.trim();
      if (!c1 || !c2) {
        msgEl.style.color = '#b91c1c';
        msgEl.textContent = 'Please complete all rating items.';
        return;
      }
      if (submittedThisSession.has(staff.id)) {
        errorEl.style.display = 'block';
        return;
      }
      const entry = {
        date: new Date().toISOString().split('T')[0],
        criteria: 'Clarity & Knowledge',
        score: ((Number(c1) + Number(c2)) / 2).toFixed(1),
        comment
      };
      staff.history.unshift(entry);
      localStorage.setItem('EMPLOYEES_DATA', JSON.stringify(EMPLOYEES));
      submittedThisSession.add(staff.id);
      msgEl.style.color = 'green';
      msgEl.textContent = 'Rating submitted successfully!';
      errorEl.style.display = 'none';
    });

    $('viewHistoryBtn').addEventListener('click', () => {
      const section = $('historySection');
      section.style.display = section.style.display === 'none' ? 'block' : 'none';
      const tbody = $('ratingsBody');
      tbody.innerHTML = staff.history.map(h =>
        `<tr><td>${h.date}</td><td>${h.criteria}</td><td>${h.score}</td><td>${h.comment || ''}</td></tr>`
      ).join('') || `<tr><td colspan="4" style="text-align:center;color:var(--muted)">No ratings yet</td></tr>`;
    });

    $('openReportBtn').addEventListener('click', () => {
      window.location.href = `reports.html?id=${staff.id}`;
    });

    $('logoutBtn').addEventListener('click', (e) => {
      e.preventDefault();
      window.location.href = 'index.html';
    });
  </script>
</body>
</html>
