<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Manage Users — NOUN Benin Study Centre</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --nav-width: 230px;
      --brand: #006400;
      --accent: #00923f;
      --muted: #6b7280;
      --bg: #f4f7f4;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
    }

    body {
      background: var(--bg);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* ───────────────────────────────
       SIDEBAR
    ─────────────────────────────── */
    .sidebar {
      width: var(--nav-width);
      background: var(--brand);
      color: #fff;
      height: 100vh;
      position: fixed;
      top: 0; left: 0;
      padding-top: 20px;
      transition: transform .3s ease;
      z-index: 2000;
    }

    .sidebar h2 {
      text-align: center;
      margin-bottom: 15px;
      font-size: 18px;
      color: #fff;
      padding: 0 10px;
    }

    .sidebar a {
      display: block;
      color: #fff;
      padding: 12px 20px;
      text-decoration: none;
      font-size: 15px;
    }

    .sidebar a:hover,
    .sidebar a[aria-current="page"] {
      background: rgba(255,255,255,.15);
    }

    /* MOBILE HIDDEN SIDEBAR */
    @media(max-width: 850px) {
      .sidebar {
        transform: translateX(-100%);
        position: fixed;
      }
      .sidebar.open {
        transform: translateX(0);
      }
    }

    /* ───────────────────────────────
       HEADER
    ─────────────────────────────── */
    .header {
      margin-left: var(--nav-width);
      padding: 14px 20px;
      background: #fff;
      border-bottom: 2px solid var(--accent);
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    @media(max-width: 850px) {
      .header {
        margin-left: 0;
      }
    }

    /* Hamburger */
    .menu-btn {
      display: none;
      font-size: 26px;
      cursor: pointer;
      color: var(--brand);
      padding: 8px 12px;
      border-radius: 6px;
    }

    @media(max-width:850px) {
      .menu-btn { display: block; }
    }

    /* ───────────────────────────────
       MAIN CONTENT
    ─────────────────────────────── */
    .main {
      margin-left: var(--nav-width);
      padding: 22px;
    }

    @media(max-width:850px) {
      .main {
        margin-left: 0;
      }
    }

    .card {
      background: #fff;
      padding: 16px;
      border-radius: 10px;
      box-shadow: 0 3px 12px rgba(0,0,0,.07);
      margin-bottom: 18px;
    }

    h1 {
      color: var(--brand);
      margin-bottom: 4px;
    }

    .muted {
      color: var(--muted);
    }

    /* ───────────────────────────────
       TOOLBAR
    ─────────────────────────────── */
    .toolbar {
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
    }

    input[type="text"], select {
      padding: 9px;
      border: 1px solid #dfe3e8;
      border-radius: 6px;
      width: 100%;
      font-size: 14px;
    }

    .toolbar .search-wrapper {
      flex: 1;
      min-width: 230px;
    }

    .btn {
      padding: 9px 14px;
      font-size: 14px;
      border: none;
      cursor: pointer;
      border-radius: 6px;
      font-weight: 700;
    }

    .btn-main {
      background: var(--brand);
      color: #fff;
    }

    .btn-alt {
      background: #fff;
      border: 1px solid var(--brand);
      color: var(--brand);
    }

    .btn-red {
      background: #d62828;
      color: #fff;
    }

    /* ───────────────────────────────
       TABLE — Responsive
    ─────────────────────────────── */
    .table-wrapper {
      overflow-x: auto;
      border-radius: 8px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 700px;
    }

    th, td {
      padding: 10px;
      border: 1px solid #eee;
      text-align: left;
      font-size: 14px;
    }

    th {
      background: var(--brand);
      color: #fff;
    }

    /* ───────────────────────────────
       MODAL
    ─────────────────────────────── */
    #modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.45);
      z-index: 3000;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .modal-box {
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      width: 100%;
      max-width: 500px;
    }

    @media(max-width:500px) {
      .modal-box {
        max-width: 90%;
      }
    }

  </style>
</head>

<body>

  <!-- SIDEBAR -->
  <nav class="sidebar" id="sidebar">
    <h2>NOUN Admin Panel</h2>

    <a href="dashboard.html">Dashboard</a>
    <a href="all-employees.html">All Staff</a>
    <a href="configure-criteria.html">Configure Criteria</a>
    <a href="manage-users.html" aria-current="page">Manage Users</a>
    <a href="reports.html">Reports</a>
  </nav>

  <!-- HEADER -->
  <header class="header">
    <span class="menu-btn" id="menuBtn">☰</span>

    <div style="display:flex;gap:12px;align-items:center">
      <img src="https://upload.wikimedia.org/wikipedia/commons/0/04/National_Open_University_of_Nigeria_Logo.png"
           style="width:40px;height:40px;object-fit:contain;border-radius:6px" />

      <div style="font-weight:800;color:var(--brand)">
        National Open University of Nigeria<br>
        <span style="font-size:13px;color:var(--accent)">
          Benin Study Centre — Staff Rating Portal
        </span>
      </div>
    </div>
  </header>

  <!-- MAIN CONTENT -->
  <main class="main">
    <div class="card">
      <h1>Manage Users</h1>
      <p class="muted">Add, edit, and manage system users.</p>

      <div class="toolbar card" style="margin-top:15px">
        <div class="search-wrapper">
          <input id="searchInput" placeholder="Search users...">
        </div>

        <select id="filterRole">
          <option value="">All Roles</option>
          <option>Admin</option>
          <option>Manager</option>
          <option>Reviewer</option>
          <option>User</option>
        </select>

        <button id="exportBtn" class="btn btn-alt">Export CSV</button>
        <button id="addUserBtn" class="btn btn-main">Add User</button>
      </div>

      <div class="card" style="margin-top:18px">
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Name</th><th>Email</th><th>Role</th><th>Department</th><th>Actions</th>
              </tr>
            </thead>
            <tbody id="usersBody">
              <tr>
                <td colspan="5" class="muted" style="text-align:center">No users yet</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div style="margin-top:12px;display:flex;justify-content:space-between;align-items:center">
          <div id="summary" class="muted">0 users</div>
          <div id="pager"></div>
        </div>
      </div>
    </div>
  </main>

  <!-- MODAL -->
  <div id="modal">
    <div class="modal-box">
      <h3 id="modalTitle">Add User</h3>

      <div style="display:grid;gap:8px;margin-top:10px">
        <input id="u_name" placeholder="Full Name">
        <input id="u_email" placeholder="Email">
        <select id="u_role">
          <option>Admin</option>
          <option>Manager</option>
          <option>Reviewer</option>
          <option>User</option>
        </select>
        <input id="u_department" placeholder="Department">

        <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px">
          <button id="cancelBtn" class="btn btn-alt">Cancel</button>
          <button id="saveUserBtn" class="btn btn-main">Save</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    /* ──────────────────────────────
       MOBILE SIDEBAR TOGGLE
    ────────────────────────────── */
    const sidebar = document.getElementById("sidebar");
    document.getElementById("menuBtn").onclick = () => {
      sidebar.classList.toggle("open");
    };

    /* ──────────────────────────────
       USER DATA STORAGE
    ────────────────────────────── */
    const KEY = "noun_users:v1";
    let users = loadUsers();

    function loadUsers() {
      try {
        const raw = localStorage.getItem(KEY);
        return raw ? JSON.parse(raw) : sampleUsers();
      } catch {
        return sampleUsers();
      }
    }

    function saveUsers() {
      localStorage.setItem(KEY, JSON.stringify(users));
      renderUsers();
    }

    function sampleUsers() {
      return [
        { id:'u1', name:'Admin User', email:'admin@nounbenin.edu.ng', role:'Admin', department:'Administration' },
        { id:'u2', name:'Mariam Abdullahi', email:'mariam@nounbenin.edu.ng', role:'Manager', department:'HR' },
        { id:'u3', name:'Michael Adeniyi', email:'michael@nounbenin.edu.ng', role:'Reviewer', department:'Finance' },
        { id:'u4', name:'Yemi Ogunleye', email:'yemi@nounbenin.edu.ng', role:'User', department:'IT' }
      ];
    }

    const usersBody   = document.getElementById("usersBody");
    const searchInput = document.getElementById("searchInput");
    const filterRole  = document.getElementById("filterRole");
    const modal       = document.getElementById("modal");
    const uName = document.getElementById("u_name");
    const uEmail = document.getElementById("u_email");
    const uRole = document.getElementById("u_role");
    const uDept = document.getElementById("u_department");
    const summary = document.getElementById("summary");

    let editingId = null;

    function renderUsers() {
      const q = searchInput.value.toLowerCase().trim();
      const role = filterRole.value;

      let filtered = users.filter(u => {
        let hay = (u.name + u.email + u.role + u.department).toLowerCase();
        if (q && !hay.includes(q)) return false;
        if (role && u.role !== role) return false;
        return true;
      });

      summary.textContent = filtered.length + " users";

      if (!filtered.length) {
        usersBody.innerHTML = `<tr><td colspan="5" class="muted" style="text-align:center">No users found</td></tr>`;
        return;
      }

      usersBody.innerHTML = filtered.map(u => `
        <tr>
          <td>${u.name}</td>
          <td>${u.email}</td>
          <td>${u.role}</td>
          <td>${u.department || ''}</td>
          <td>
            <button class="btn btn-alt" data-edit="${u.id}">Edit</button>
            <button class="btn btn-red" data-del="${u.id}">Delete</button>
          </td>
        </tr>
      `).join("");

      attachActions();
    }

    function attachActions() {
      document.querySelectorAll("[data-edit]").forEach(btn => {
        btn.onclick = () => openEdit(btn.dataset.edit);
      });

      document.querySelectorAll("[data-del]").forEach(btn => {
        btn.onclick = () => {
          if (!confirm("Delete user?")) return;
          users = users.filter(u => u.id !== btn.dataset.del);
          saveUsers();
        };
      });
    }

    document.getElementById("addUserBtn").onclick = () => openAdd();

    function openAdd() {
      editingId = null;
      document.getElementById("modalTitle").textContent = "Add User";
      uName.value = ""; uEmail.value = ""; uRole.value = "User"; uDept.value = "";
      modal.style.display = "flex";
    }

    function openEdit(id) {
      const u = users.find(x => x.id === id);
      if (!u) return;
      editingId = id;
      document.getElementById("modalTitle").textContent = "Edit User";
      uName.value = u.name;
      uEmail.value = u.email;
      uRole.value = u.role;
      uDept.value = u.department;
      modal.style.display = "flex";
    }

    document.getElementById("cancelBtn").onclick = () =>
      modal.style.display = "none";

    document.getElementById("saveUserBtn").onclick = () => {
      let name = uName.value.trim(),
          email = uEmail.value.trim(),
          role = uRole.value,
          dept = uDept.value.trim();

      if (!name || !email) return alert("Name and email required");

      if (editingId) {
        let u = users.find(x => x.id === editingId);
        u.name = name;
        u.email = email;
        u.role = role;
        u.department = dept;
      } else {
        users.push({
          id: "u" + Date.now(),
          name, email, role, department: dept
        });
      }
      saveUsers();
      modal.style.display = "none";
    };

    searchInput.oninput = () => renderUsers();
    filterRole.onchange = () => renderUsers();

    document.getElementById("exportBtn").onclick = () => {
      const csv = [
        "Name,Email,Role,Department",
        ...users.map(u =>
          `"${u.name}","${u.email}","${u.role}","${u.department||''}"`
        )
      ].join("\n");

      const blob = new Blob([csv], { type: "text/csv" });
      const url = URL.createObjectURL(blob);

      const a = document.createElement("a");
      a.href = url;
      a.download = "users_export.csv";
      a.click();
      URL.revokeObjectURL(url);
    };

    renderUsers();
  </script>

</body>
</html>
