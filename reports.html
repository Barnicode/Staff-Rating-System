```html
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>University Staff Rating Portal — Reports</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{--nav-width:220px;--brand:#003366;--accent:#cc0000;--muted:#6b7280}
    *{box-sizing:border-box;margin:0;padding:0;font-family:'Segoe UI',sans-serif}
    body{background:#f4f4f4;min-height:100vh}
    .sidebar{width:var(--nav-width);background:var(--brand);color:#fff;height:100vh;position:fixed;top:0;left:0;padding-top:20px}
    .sidebar h2{text-align:center;color:#ff4d4d;margin-bottom:18px}
    .sidebar a{display:block;color:#fff;padding:12px 18px;text-decoration:none}
    .sidebar a:hover{background:#0055aa}
    .header-bar{margin-left:var(--nav-width);background:#fff;padding:12px 20px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid #e6e9ee;position:sticky;top:0;z-index:10}
    .header-bar img{width:40px;height:40px;object-fit:contain}
    .main{margin-left:var(--nav-width);padding:26px}
    .card{background:#fff;padding:16px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.04);margin-bottom:16px}
    .controls-row{display:flex;gap:12px;align-items:center;margin-bottom:12px;flex-wrap:wrap}
    select,input[type="month"]{padding:8px;border:1px solid #e6e9ee;border-radius:6px}
    .btn{padding:8px 12px;background:var(--brand);color:#fff;border-radius:6px;border:0;cursor:pointer;font-weight:700}
    .btn.primary{background:var(--accent)}
    .summary-box{display:flex;gap:20px;margin-bottom:20px;flex-wrap:wrap}
    .summary-card{flex:1;min-width:200px;background:#fff;padding:18px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.04);text-align:center}
    .summary-card h2{color:var(--brand);margin-bottom:8px;font-size:16px}
    .summary-card p{font-size:22px;font-weight:800;color:var(--accent);margin:0}
    table{width:100%;border-collapse:collapse;background:#fff;margin-bottom:20px}
    th,td{padding:12px;border:1px solid #eef2f6;text-align:left}
    th{background:var(--brand);color:#fff}
    .bar-chart{display:flex;flex-direction:column;gap:10px}
    .bar{background:var(--accent);height:28px;color:white;padding-left:12px;border-radius:6px;line-height:28px}
    pre{background:#0b1220;color:#e6eef8;padding:12px;border-radius:6px;overflow:auto;max-height:320px}
    .muted{color:var(--muted);font-size:13px}
    @media(max-width:900px){.summary-box{flex-direction:column}}
  </style>
</head>
<body>
  <nav class="sidebar" aria-label="Sidebar navigation">
    <h2>Admin Panel</h2>
    <a href="control-center.html">Dashboard</a>
    <a href="all-employees.html">All Employees</a>
    <a href="rate-staff.html">Rate Staff</a>
    <a href="reports.html" aria-current="page">Reports</a>
    <a href="settings.html">Settings</a>
  </nav>

  <header class="header-bar" role="banner">
    <div style="display:flex;align-items:center;gap:12px">
      <img src="https://static.vecteezy.com/system/resources/thumbnails/006/470/455/small_2x/university-education-logo-design-template-vector.jpg" alt="Logo" />
      <div style="font-weight:800;color:var(--brand);font-size:18px">University Staff Rating Portal — Reports</div>
    </div>
    <div><a href="login.html" style="color:var(--brand);font-weight:700;text-decoration:none">Log Out</a></div>
  </header>

  <main class="main" role="main">
    <div class="card">
      <h1 style="color:var(--accent);margin:0 0 12px">Performance Reports</h1>

      <div class="controls-row">
        <label for="deptSelect" class="muted">Department</label>
        <select id="deptSelect"><option value="">All departments</option></select>

        <label for="periodInput" class="muted">Period</label>
        <input type="month" id="periodInput" />

        <button class="btn primary" id="generateBtn">Generate</button>
        <button class="btn" id="exportCsvBtn">Export CSV</button>

        <div style="margin-left:auto" class="muted" id="reportStatus">Ready</div>
      </div>

      <div class="summary-box" id="summaryBox">
        <div class="summary-card"><h2>Average Rating</h2><p id="avgRating">—</p></div>
        <div class="summary-card"><h2>Top Performer</h2><p id="topPerformer">—</p></div>
        <div class="summary-card"><h2>Most Rated Dept</h2><p id="mostRatedDept">—</p></div>
      </div>

      <div id="reportsOutput">
        <h2 style="margin:0 0 8px">Staff Ratings Table</h2>
        <table id="ratingsTable" aria-live="polite">
          <thead><tr><th>Name</th><th>Department</th><th>Rating</th><th>Comments</th></tr></thead>
          <tbody id="ratingsBody"><tr><td colspan="4" class="muted" style="text-align:center">No report generated yet</td></tr></tbody>
        </table>

        <h2 style="margin:0 0 8px">Rating Distribution</h2>
        <div class="bar-chart" id="barChart">
          <div class="bar" style="width:0%">5 - Excellent</div>
          <div class="bar" style="width:0%">4 - Very Good</div>
          <div class="bar" style="width:0%">3 - Good</div>
          <div class="bar" style="width:0%">2 - Fair</div>
          <div class="bar" style="width:0%">1 - Poor</div>
        </div>

        <div style="margin-top:12px">
          <h3 style="margin:0 0 6px">Raw JSON (preview)</h3>
          <pre id="jsonPreview">No data</pre>
        </div>
      </div>
    </div>
  </main>

  <script>
    // Demo-ready reports page that uses shared employee dataset if available.
    // Replace endpoints with your backend when ready.
    const API = {
      departmentReport: '/api/reports/department'
    };

    function demoEmployees(){
      const NAMES = [
        "Adetola Adebayo","Aisha Bello","Akinola Abiola","Amaka Obi","Babatunde Johnson","Bola Akin","Chiamaka Okoye",
        "Chinedu Nwosu","David Okoro","Doris Mensah","Ebuka Nwankwo","Efe Akanno","Esther Musa","Fatima Bello",
        "Femi Olagunju","Folake Adeoye","Funmi Oladipo","Grace Adebayo","Hauwa Suleiman","Ibrahim Musa","Ifeoma Anene",
        "Ikechukwu Okafor","Ijeoma Ndukwe","James Adedayo","Joseph Danjuma","Joy Igwe","Kemi Bakare","Kelvin Ojo",
        "Kenneth Udo","Khadija Umar","Kofi Mensah","Kunle Afolayan","Lara Ibrahim","Linda Uche","Mariam Abdullahi",
        "Michael Adeniyi","Mohammed Usman","Mrs. Olatunji","Nana Yaw","Ngozi Eze","Nicholas Osei","Nkechi Amadi",
        "Obinna Chukwu","Olajide Taiwo","Olufunke Adeyemi","Omolara Akinyemi","Paul Ekong","Peter Okoye","Phillip Bassey",
        "Rachel Okpara","Rita Nnamdi","Samuel Eze","Sandra Akpan","Sani Bello","Sarah Okonkwo","Segun Lawal",
        "Shehu Ibrahim","Simeon Olufemi","Siti Ali","Stanley Ibe","Stephen Nwachukwu","Susan Ogbuefi","Taiwo Balogun",
        "Tariq Mohammed","Tola Adekunle","Uche Okafor","Umar Abdullahi","Valentina Kalu","Victor Amankwa","Victoria Obi",
        "Wale Adewale","Yasir Khan","Yemi Ogunleye","Yinka Adegoke","Yusuf Adamu","Zainab Mohammed","Zara Hussain",
        "Adeniyi Sola","Bisi Ogun","Chukwuemeka Eze","Dolapo Aina","Emeka Nnaji","Folasade Ogundipe","Geraldine Nweke",
        "Hassan Abubakar","Ibrahim Balogun","Jide Taiwo","Kalu Chike","Lilian Ojo","Moses Akintola","Nura Suleiman",
        "Olaide Komolafe","Paulina Ezugwu","Quincy Mensah","Rose Afolabi","Stanley Obasi","Tunde Raimi","Uwana Ebi",
        "Vera Aniekeme","Woli Ade","Xolani Dlamini","Yvonne Oluchi","Zubairu Bello"
      ];
      const DEPARTMENTS = ['IT','HR','Finance','Admin','Legal','Operations','Marketing','Registry','Research'];
      const SAMPLE_RATINGS = [null,4.8,4.6,4.4,4.2,3.9,3.6];
      return NAMES.slice(0,92).map((fullName, idx) => {
        const i = idx + 1;
        const dept = DEPARTMENTS[i % DEPARTMENTS.length];
        const rated = (i % 3 !== 0);
        const rating = rated ? SAMPLE_RATINGS[i % SAMPLE_RATINGS.length] : null;
        return {
          id: 'emp-' + String(i).padStart(3,'0'),
          fullName, department: dept,
          rating, email: `${fullName.toLowerCase().replace(/[^a-z]/g,'')}${i}@university.edu`,
          comments: rating ? `${rating >=4.5 ? 'Excellent' : rating >=4.0 ? 'Very good' : 'Needs improvement'}` : '',
          history: rating ? [
            { date:'2023-10-01', criteria:'Clarity of instruction', score: Math.min(5, Math.round(rating)), comment:'Very clear lectures' },
            { date:'2023-10-01', criteria:'Knowledge of subject', score: Math.max(3, Math.round(rating-1)), comment:'Good subject mastery' }
          ] : []
        };
      });
    }

    const EMPLOYEES = Array.isArray(window._EMPLOYEE_DATA) ? window._EMPLOYEE_DATA : demoEmployees();

    function populateDepartments(){
      const set = new Set(EMPLOYEES.map(e => e.department).filter(Boolean));
      const sel = document.getElementById('deptSelect');
      sel.innerHTML = '<option value="">All departments</option>' + Array.from(set).sort().map(d => `<option value="${d}">${d}</option>`).join('');
    }

    function computeReport({dept=null, period=null, staffId=null}){
      let pool = EMPLOYEES.slice();
      if(staffId){
        pool = pool.filter(e => e.id === staffId || (e.fullName && e.fullName.toLowerCase() === staffId.toLowerCase()));
      } else {
        if(dept) pool = pool.filter(e => e.department === dept);
      }
      const rows = pool.filter(e => e.rating !== null).map(e => ({
        name: e.fullName,
        department: e.department,
        rating: Number((e.rating || 0).toFixed(1)),
        comments: e.comments || '',
        history: e.history || []
      }));
      const avgRating = rows.length ? rows.reduce((s,r)=>s + r.rating,0) / rows.length : null;
      const topPerformer = rows.length ? rows.slice().sort((a,b)=>b.rating - a.rating)[0].name : null;
      const counts = {};
      EMPLOYEES.forEach(e => { if(e.rating !== null) counts[e.department] = (counts[e.department]||0) + 1; });
      const mostRatedDept = Object.keys(counts).length ? Object.entries(counts).sort((a,b)=>b[1]-a[1])[0][0] : null;
      const distCounts = {'5':0,'4':0,'3':0,'2':0,'1':0};
      rows.forEach(r => { const key = String(Math.max(1, Math.min(5, Math.round(r.rating)))); distCounts[key]++; });
      const total = rows.length || 1;
      const distribution = Object.fromEntries(Object.entries(distCounts).map(([k,v])=>[k, v / total]));
      return { summary: { avgRating, topPerformer, mostRatedDept }, rows, distribution };
    }

    function renderTable(rows){
      const body = document.getElementById('ratingsBody');
      if(!rows || !rows.length){
        body.innerHTML = '<tr><td colspan="4" class="muted" style="text-align:center">No records for selected period/department</td></tr>';
        return;
      }
      body.innerHTML = rows.map(r => `<tr><td>${r.name}</td><td>${r.department}</td><td>${r.rating.toFixed(1)}</td><td>${r.comments || ''}</td></tr>`).join('');
    }

    function renderDistribution(dist){
      const chart = document.getElementById('barChart');
      const pct = (k) => Math.round((dist && dist[k] ? dist[k] : 0) * 100);
      chart.innerHTML = [
        `<div class="bar" style="width:${pct('5')}%">5 - Excellent</div>`,
        `<div class="bar" style="width:${pct('4')}%">4 - Very Good</div>`,
        `<div class="bar" style="width:${pct('3')}%">3 - Good</div>`,
        `<div class="bar" style="width:${pct('2')}%">2 - Fair</div>`,
        `<div class="bar" style="width:${pct('1')}%">1 - Poor</div>`
      ].join('');
    }

    function setSummary(avg, top, mostDept){
      document.getElementById('avgRating').textContent = avg !== null ? avg.toFixed(2) : '—';
      document.getElementById('topPerformer').textContent = top || '—';
      document.getElementById('mostRatedDept').textContent = mostDept || '—';
    }

    async function generateReport(){
      const dept = document.getElementById('deptSelect').value || null;
      const period = document.getElementById('periodInput').value || null;
      const staffId = new URL(location.href).searchParams.get('staffId') || null;
      document.getElementById('reportStatus').textContent = 'Generating...';

      try {
        if (!staffId && API.departmentReport.startsWith('/api')) {
          const params = new URLSearchParams();
          if(dept) params.set('dept', dept);
          if(period) params.set('period', period);
          const res = await fetch(`${API.departmentReport}?${params.toString()}`, { credentials: 'include' });
          if (res.ok) {
            const rpt = await res.json();
            setSummary(rpt.summary?.avgRating, rpt.summary?.topPerformer, rpt.summary?.mostRatedDept);
            renderTable(rpt.rows || []);
            renderDistribution(rpt.distribution || {});
            document.getElementById('jsonPreview').textContent = JSON.stringify(rpt, null, 2);
            document.getElementById('reportStatus').textContent = 'Report generated (server)';
            return;
          }
        }
      } catch (e) {}

      const rpt = computeReport({ dept, period, staffId });
      setSummary(rpt.summary?.avgRating, rpt.summary?.topPerformer, rpt.summary?.mostRatedDept);
      renderTable(rpt.rows || []);
      renderDistribution(rpt.distribution || {});
      document.getElementById('jsonPreview').textContent = JSON.stringify(rpt, null, 2);
      document.getElementById('reportStatus').textContent = staffId ? `Report for ${staffId}` : 'Report generated (client)';
    }

    function exportCsv(){
      const rows = Array.from(document.querySelectorAll('#ratingsBody tr')).map(tr => Array.from(tr.children).map(td => td.textContent.trim()));
      if(!rows.length){ alert('No data to export'); return; }
      const headers = ['Name','Department','Rating','Comments'];
      const csv = [headers.join(','), ...rows.map(r => r.map(v => `"${(v||'').replace(/"/g,'""')}"`).join(','))].join('\n');
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      const dept = document.getElementById('deptSelect').value || 'all';
      const period = document.getElementById('periodInput').value || 'period';
      a.href = url;
      a.download = `report_${dept}_${period}.csv`;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    function attemptStaffSpecificRenderOnLoad(){
      const params = new URL(location.href).searchParams;
      const staffId = params.get('staffId');
      if(staffId){
        const staff = EMPLOYEES.find(e => e.id === staffId || (e.fullName && e.fullName.toLowerCase() === staffId.toLowerCase()));
        if(staff && staff.department){
          document.getElementById('deptSelect').value = staff.department;
        }
        generateReport();
      } else {
        generateReport();
      }
    }

    // Wire UI
    document.getElementById('generateBtn').addEventListener('click', generateReport);
    document.getElementById('exportCsvBtn').addEventListener('click', exportCsv);

    // init
    populateDepartments();
    attemptStaffSpecificRenderOnLoad();

    // expose utilities for debugging
    window._REPORTS = { EMPLOYEES, computeReport, generateReport };
  </script>
</body>
</html>
```